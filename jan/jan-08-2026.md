# Day 8 - 10, Jan 08, 2025 - Jan 10, 2025

Yesterday We did a lot of css. But now, we will use the database. So we will be
writing the http methods. From a previous day's devlog we have the methods.

|  HTTP  |  Mine   | Completion |  
|:------:|:-------:|:----------:|
|  get   |   get   | completed  |
|  post  | create  | completed  |
|  put   | replace |            |
| delete | delete  | completed  |
| patch  | update  |            |

## HTTP Method: Get

We get visual entertainment and entertainment. For entertainment, we use id and
text. and for visual entertainment it is the same. we already have the methods
for getting the data.

1. entertainment via id: `get -etid { id }`
2. entertainment via string: `get -etid -s "string string string"`
3. visual entertainment via id: `get -etid -v { id }`
4. visual entertainment via string: `get -etid -vs "string string"`

I will be writing code in the actual project repo.

## FileSystem Update

First is my personal FileSystem library and update File Structure. (Old: Check [Jan 03, 2026](/jan/jan-03-2026.md))

```
|--- lib
|   |--- JFileSystem.jar (Custom Lib)
|--- src
|   |--- main
|   |   |--- java
|   |   |   |--- com.aadarsh.etr3
|   |   |   |   |--- Launcher (Launches Main.java extends javafx Application)
|   |   |   |   |--- backend
|   |   |   |   |   |--- data
|   |   |   |   |   |   |--- record Entertainment
|   |   |   |   |   |   |--- record VisualEntertainment
|   |   |   |   |   |--- database
|   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |--- Manager (Connect/Disconnect to SQLiteDB)
|   |   |   |   |   |   |   |--- QuerierQuerierQuerier (SQLite Statements)
|   |   |   |   |   |--- v1
|   |   |   |   |   |   |--- Backend (Data Processing)
|   |   |   |   |   |   |--- InternalConfig (Data Processing)
|   |   |   |   |--- api
|   |   |   |   |   |--- v1
|   |   |   |   |   |   |--- Api
|   |   |   |   |--- cli
|   |   |   |   |   |--- v1
|   |   |   |   |   |    |--- CLI (takes input and makes sure it is valid)
|   |   |   |   |--- module-info.java
|   |   |   |   |--- ui
|   |   |   |   |   |--- v1
|   |   |   |   |   |   |--- Main
|   |   |   |   |   |   |--- custom
|   |   |   |   |   |   |--- controllers
|   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |--- MainFrameController
|   |   |   |   |   |   |   |--- module
|   |   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |   |--- ModuleController (Parent)
|   |   |   |   |   |   |   |   |   |--- MovieModuleController (Child)
|   |   |   |   |   |   |   |   |   |--- ShowModuleController (Child)
|   |   |   |   |   |   |   |   |   |--- EpisodeModuleController (Child)
|   |   |   |   |   |   |   |--- viewer
|   |   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |   |--- ViewerController (Parent)
|   |   |   |   |   |   |   |   |   |--- MovieViewerController (Child)
|   |   |   |   |   |   |   |   |   |--- ShowViewerController (Child)
|   |   |   |   |   |   |   |   |   |--- EpisodeViewerController (Child)
|   |   |   |   |   |   |   |--- editor
|   |   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |   |--- EditorController (Parent)
|   |   |   |   |   |   |   |   |   |--- MovieEditorController (Child)
|   |   |   |   |   |   |   |   |   |--- ShowEditorController (Child)
|   |   |   |   |   |   |   |   |   |--- EpisodeEditorController (Child)
|   |   |--- resources
|   |   |   |--- log4j2.xml
|   |   |   |--- com.aadarsh.etr3
|   |   |   |   |--- internal
|   |   |   |   |   |--- configs
|   |   |   |   |   |   |--- entertainmenttracker.configs
|   |   |   |   |--- ui
|   |   |   |   |   |--- fxml
|   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |--- MainFrame
|   |   |   |   |   |   |   |--- module
|   |   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |   |--- MovieModule
|   |   |   |   |   |   |   |   |   |--- ShowModule
|   |   |   |   |   |   |   |   |   |--- EpisodeModule
|   |   |   |   |   |   |   |--- viewer
|   |   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |   |--- MovieViewer
|   |   |   |   |   |   |   |   |   |--- ShowViewer
|   |   |   |   |   |   |   |   |   |--- EpisodeViewer
|   |   |   |   |   |   |   |--- editor
|   |   |   |   |   |   |   |   |--- v1
|   |   |   |   |   |   |   |   |   |--- MovieEditor
|   |   |   |   |   |   |   |   |   |--- ShowEditor
|   |   |   |   |   |   |   |   |   |--- EpisodeEditor
|   |   |   |   |   |--- css
|   |   |   |   |   |   |--- v1
|--- somewhere in User/AppData/local
|   |--- EntertainmentTracker
|   |   |--- { Enter Version Number }
|   |   |   |--- database
|   |   |   |   |--- etdb_1.sqlite (becomes below)
|   |   |   |   |--- database.entertainmenttracker.sqlite (new database by moving data)
|   |   |   |--- configs
|   |   |   |   |--- entertainmenttracker.settings
|   |   |   |   |--- entertainmenttracker.preferences (maybe merged with above)
|   |   |   |   |--- entertainmenttracker.themes (maybe)
|   |   |   |--- themes (Needs Testing)
|   |   |   |   |--- test.theme.entertainmenttracker.css
|   |   |   |   |--- light.theme.entertainmenttracker.css
|   |   |   |   |--- dark.theme.entertainmenttracker.css
```

The package `com.aadarsh.etr3.ui.v1.custom` will contain custom classes like SVGButton (Like
SVGLabelButton).

## Database Connection

Duplicated database and renamed it as `database.entertainmenttracker.sqlite` from
`etdb_1.sqlite` (1 in [Sources](#SourcesResources)). Connect to database. I forgot
to add the `jdbs:sqlite` to the filepath (5 in [Sources](#SourcesResources)).
```java
private final Connection connection = DriverManager.getConnection("jdbc:sqlite:" + databasePath);
```

## Logging via Log4J Core and Log4J API

Logging in the app is really useful for app, not when coding. So when coding,
`System.out.println()` or `System.exit.println()` will be used heavily. When
deploying the app, **Log4J Core** will be used to hold logs.
(2 in [Sources](#SourcesResources)).

# The Problem
While trying to fix Log4J, the project broke. maven and intellij broke the project
so, I had to remake the project :(

Now the project is **_Entertainment Tracker Rebuild 4_**.

## Fixing Log4J Logging

Only Errors and Fatal were being printed. so now I needed to config Log4J. Use
Telusko's Video on Log4J (7 in [Sources](#SourcesResources)).

And after long time I found the fix. I had `log4j2.xml` in the wrong folder.
- wrong: `src/main/resources/com/aadarsh/etr3/log4j2.xml`
- correct: `src/main/resources/log4j2.xml`

Now I can print all logs and write from info up to fatal logs.

## Fixing Database Driver

I have this exception: `java.sql.SQLException: No suitable driver found for jdbc:sqlite:D:\Programming\Java\Projects\Entertainment_Tracker\database.entertainmenttracker.sqlite`

I had the wrong dependency for sqlite.

Correct:
```xml
<!-- https://mvnrepository.com/artifact/com.mysql/mysql-connector-j -->
      <dependency>
          <groupId>com.mysql</groupId>
          <artifactId>mysql-connector-j</artifactId>
          <version>9.5.0</version>
      </dependency>
```

Wrong:
```xml
<!-- https://mvnrepository.com/artifact/org.xerial/sqlite-jdbc -->
<dependency>
    <groupId>org.xerial</groupId>
    <artifactId>sqlite-jdbc</artifactId>
    <version>3.51.1.0</version>
</dependency>
```

## Package: Backend

We have a main class `Backend`, `DataBaseManager` and, `DataBaseQuerier` for DataBase
management. And many supporting classes: `InternalConfig` with exceptions
`EntertainmentNotFoundException`.

## HTTP: GET

1. Entertainment: Id

    ```java
    public Entertainment getEntertainment(int id) throws SQLException {
   
        // sql search query
        String searchQuery = String.format("select * from entertainment_table where id = %d;", id);
   
        // sql search query statement
        PreparedStatement preparedStatement = connection.prepareStatement(searchQuery);
        
        // excecute sql statement
        ResultSet resultSet = preparedStatement.executeQuery();
    
        // get data
        int eid = resultSet.getInt("id");
        String name = resultSet.getString("name");
        EntertainmentType type = EntertainmentType.valueOf(resultSet.getString("type").toUpperCase());
        LocalDate date = LocalDate.parse(resultSet.getString("localDate"));
    
        EntertainmentStatus status = EntertainmentStatus.valueOf(resultSet.getString("status").toUpperCase());
        if (status.equals(EntertainmentStatus.UPCOMING) && LocalDate.now().isAfter(date)) {
            status = EntertainmentStatus.RELEASED;
        } else if (LocalDate.now().isBefore(date)) {
			status = EntertainmentStatus.UPCOMING;
		}
    
        boolean isSpecial = resultSet.getBoolean("isSpecial");
        boolean isPilot = resultSet.getBoolean("isPilot");
        boolean isFavorite = resultSet.getBoolean("isFavorite");
    
        int seasonId = resultSet.getInt("seasonId");
        int episodeNum = resultSet.getInt("episodeNum");
        int duration = resultSet.getInt("duration");
    
        ArrayList<String> tags = new ArrayList<>();
        for (int i = 1; i <= 15; i++) {
            String tag = resultSet.getString("tags_" + i);
            if (tag.isBlank()) continue;
            System.out.println("tag_" + i + ": " + tag);
            tags.add(tag);
        }
    
        // create obj
        Entertainment entertainment = Entertainment.builder()
                .id(eid)
                .name(name)
                .type(type)
                .date(date)
    
                .status(status)
                .isSpecial(isSpecial)
                .isPilot(isPilot)
                .isFavorite(isFavorite)
    
                .seasonId(seasonId)
                .episodeNum(episodeNum)
                .duration(duration)
    
                .tags(tags.toArray(new String[0]))
    
                .build();
    
        return entertainment; // return obj
    }
    ```

2. VisualEntertainment: Id

    ```java
     public VisualEntertainment getVisualEntertainment(int id) throws SQLException, EntertainmentNotFoundException {
         return new VisualEntertainment(getEntertainment(id));
     }
    ```

3. Entertainment: Text

    ```java
    public Entertainment[] getEntertainments(String text) throws SQLException {
        String sqlText = "%" + text + "%";
        LOGGER.debug("sqlText: {}", sqlText);
        String searchQuery = String.format(
            "select * from %s where " +
            "name like ? or " +
            "tags_1 like ? or " +
            "tags_2 like ? or " +
            "tags_3 like ? or " +
            "tags_4 like ? or " +
            "tags_5 like ? or " +
            "tags_6 like ? or " +
            "tags_7 like ? or " +
            "tags_8 like ? or " +
            "tags_9 like ? or " +
            "tags_10 like ? or " +
            "tags_11 like ? or " +
            "tags_12 like ? or " +
            "tags_13 like ? or " +
            "tags_14 like ? or " +
            "tags_15 like ?;",
            tableName
        );
        LOGGER.debug("sql: {}", searchQuery);
    
        PreparedStatement preparedStatement = connection.prepareStatement(searchQuery);
    
        for (int i = 1; i <= 15; i++) {
            preparedStatement.setString(i, sqlText);
        }
    
        ResultSet resultSet = preparedStatement.executeQuery();
    
        ArrayList<Entertainment> entertainments = new ArrayList<>();
        while (resultSet.next()) {
    
            int id = resultSet.getInt("id");
            String name = resultSet.getString("name");
            EntertainmentType type = EntertainmentType.valueOf(resultSet.getString("type").toUpperCase());
            LocalDate date = LocalDate.parse(resultSet.getString("localDate"));
    
            EntertainmentStatus status = EntertainmentStatus.valueOf(resultSet.getString("status").toUpperCase());
            if (status.equals(EntertainmentStatus.UPCOMING) && LocalDate.now().isAfter(date)) {
                status = EntertainmentStatus.RELEASED;
            } else if (LocalDate.now().isBefore(date)) {
                status = EntertainmentStatus.UPCOMING;
            }
    
            boolean isSpecial = resultSet.getBoolean("isSpecial");
            boolean isPilot = resultSet.getBoolean("isPilot");
            boolean isFavorite = resultSet.getBoolean("isFavorite");
    
            int seasonId = resultSet.getInt("seasonId");
            int episodeNum = resultSet.getInt("episodeNum");
            int duration = resultSet.getInt("duration");
    
            ArrayList<String> tags = new ArrayList<>();
            for (int i = 1; i <= 15; i++) {
                String tag = resultSet.getString("tags_" + i);
                if (tag.isBlank()) continue;
                tags.add(tag);
            }
    
            Entertainment entertainment = Entertainment.builder()
                .id(id)
                .name(name)
                .type(type)
                .date(date)
    
                .status(status)
                .isSpecial(isSpecial)
                .isPilot(isPilot)
                .isFavorite(isFavorite)
    
                .seasonId(seasonId)
                .episodeNum(episodeNum)
                .duration(duration)
    
                .tags(tags.toArray(new String[0]))
                .build();
    
            entertainments.add(entertainment);
        }
    
        resultSet.close();
        return entertainments.toArray(new Entertainment[0]);
    }
    ```

4. VisualEntertainment: Text

    ```java
    public VisualEntertainment[] getVisualEntertainment(String text) {
         Entertainment[] entertainments = getEntertainments(text);
    
         if (entertainments.length == 0) return null;
    
         ArrayList<VisualEntertainment> visualEntertainments = new ArrayList<>();
         Arrays.stream(entertainments).toList().forEach((entertainment) ->
                visualEntertainments.add(new VisualEntertainment(entertainment))
         );
    
         return visualEntertainments.toArray(new VisualEntertainment[0]);
    }
    ```

## HTTP: POST

```java
public void createEntertainment(Entertainment entertainment) throws SQLException {
    String insertQuery = String.format("insert into %s (" +
            "name, type, localDate, " +
            "status, isSpecial, isPilot, isFavorite, " +
            "seasonId, episodeNum, duration, " +

            "tags_1, tags_2, tags_3, tags_4, tags_5, tags_6, " +
            "tags_7, tags_8, tags_9, tags_10, tags_11, tags_12, " +
            "tags_13, tags_14, tags_15)" +
            "values (" +
            "?, ?, ?, " +
            "?, ?, ?, ?, " +
            "?, ?, ?, " +
            "?, ?, ?, ?, ?, ?, " +
            "?, ?, ?, ?, ?, ?, " +
            "?, ?, ?)", tableName);

    PreparedStatement preparedStatement = null;
    try {
        preparedStatement = connection.prepareStatement(insertQuery);
        preparedStatement.setString(1, entertainment.name());
        preparedStatement.setString(2, entertainment.type().name().toLowerCase());
        preparedStatement.setString(3, entertainment.date().toString());
        preparedStatement.setString(4, entertainment.status().name().toLowerCase());
        preparedStatement.setBoolean(5, entertainment.isSpecial());
        preparedStatement.setBoolean(6, entertainment.isPilot());
        preparedStatement.setBoolean(7, entertainment.isFavorite());
        preparedStatement.setInt(8, entertainment.seasonId());
        preparedStatement.setInt(9, entertainment.episodeNum());
        preparedStatement.setInt(10, entertainment.duration());
        String[] tags = entertainment.tags();
        for (int i = 1; i <= 15; i++) {
            String tag;
            try {
                tag = tags[i];
            } catch (NullPointerException | ArrayIndexOutOfBoundsException _) {
                tag = "";
            }
            preparedStatement.setString((10 + i), tag);
        }

    } catch (SQLException e) {
        throw new RuntimeException(e);
    }

    preparedStatement.executeUpdate();
}
```

## HTTP: DELETE

```java
	public void deleteEntertainment(int id) throws SQLException {
		String deleteQuery = String.format("delete from %s where id = ?", tableName);
		PreparedStatement preparedStatement = null;
		try {
			preparedStatement = connection.prepareStatement(deleteQuery);
			preparedStatement.setInt(1, id);
		} catch (SQLException e) {
			throw new RuntimeException(e);
		}

		preparedStatement.execute();
	}
```


## Sources/Resources
1. [Does it matter what extension is used for SQLite database files?](https://stackoverflow.com/questions/808499/does-it-matter-what-extension-is-used-for-sqlite-database-files) from Stack Overflow
2. [How can I get started with Log4j?](https://logging.apache.org/log4j/2.x/manual/getting-started.html) from Log4J
3. [A Guide to System.exit()](https://www.baeldung.com/java-system-exit) from Baeldung
4. [How to return enum value in java](https://stackoverflow.com/questions/31849497/how-to-return-enum-value-in-java) from Stack Overflow
5. [SQLite Java: Connect to a SQLite Database](https://www.sqlitetutorial.net/sqlite-java/sqlite-jdbc-driver/) from SQLite Tutorial
6. [Apache Log4j](https://www.geeksforgeeks.org/java/apache-log4j/) from GeeksForGeeks
7. [Logging in Java using Log4J](https://www.youtube.com/watch?v=2IVyyo3DA7U&t=146s) by Telusko
8. [Converting a String to an Enum in Java](https://www.geeksforgeeks.org/java/converting-a-string-to-an-enum-in-java/) from GeeksForGeeks
9. [SQL EXISTS Operator](https://www.w3schools.com/sql/sql_exists.asp) from W3Schools
10. [How to use SQLite DB Browser for Efficient Database Management](https://www.w3resource.com/sqlite/snippets/sqlite-db-browser-guide.php) (Run SQL Statements in DB Browser) from W3Resources
11. [SQL Query to Match Any Part of String](https://www.geeksforgeeks.org/sql/sql-query-to-match-any-part-of-string/) from GeeksForGeeks
12. [SQL INSERT INTO Statement](https://www.w3schools.com/sql/sql_insert.asp) from W3Schools
13. [SQL UPDATE Statement](https://www.w3schools.com/SQL/sql_update.asp) from W3Schools
14. [SQL DELETE Statement](https://www.w3schools.com/SQL/sql_delete.asp) from W3Schools
15. []()
16. []()
17. []()
18. []()
19. []()
20. []()


